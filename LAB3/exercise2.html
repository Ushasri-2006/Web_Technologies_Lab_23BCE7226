<!DOCTYPE html>
<html>
<head>
  <title>Intelligent Shopping Cart</title>
  <style>
    table { border-collapse: collapse; width: 60%; }
    th, td { border: 1px solid black; padding: 8px; text-align: center; }
  </style>
</head>
<body>

<h2>Shopping Cart</h2>

<table id="cartTable">
  <tr>
    <th>Product</th>
    <th>Price</th>
    <th>Quantity</th>
    <th>Total</th>
    <th>Action</th>
  </tr>
</table>

<br>
Coupon Code:
<input type="text" id="coupon">
<button onclick="applyCoupon()">Apply</button>

<h3 id="finalAmount"></h3>

<script>
let cart = [
  { name: "Laptop", price: 50000, quantity: 1, category: "electronics" },
  { name: "Shirt", price: 2000, quantity: 2, category: "clothing" }
];

let couponDiscount = 0;

/* 1️⃣ Display Cart Dynamically */
function displayCart() {
  const table = document.getElementById("cartTable");
  table.innerHTML = `
    <tr>
      <th>Product</th>
      <th>Price</th>
      <th>Quantity</th>
      <th>Total</th>
      <th>Action</th>
    </tr>`;

  let total = 0;

  cart.forEach((item, index) => {
    let itemTotal = item.price * item.quantity;
    total += itemTotal;

    table.innerHTML += `
      <tr>
        <td>${item.name}</td>
        <td>${item.price}</td>
        <td>
          <input type="number" value="${item.quantity}" min="1"
          onchange="updateQuantity(${index}, this.value)">
        </td>
        <td>${itemTotal}</td>
        <td><button onclick="removeItem(${index})">Remove</button></td>
      </tr>`;
  });

  let discount = calculateDiscount(total);
  let finalTotal = total - discount - couponDiscount;

  document.getElementById("finalAmount").innerText =
    `Total: ₹${total} | Discount: ₹${discount + couponDiscount} | Final: ₹${finalTotal}`;
}

/* 2️⃣ Update Quantity */
function updateQuantity(index, qty) {
  cart[index].quantity = parseInt(qty);
  displayCart();
}

/* 3️⃣ Remove Item */
function removeItem(index) {
  cart.splice(index, 1);
  displayCart();
}

/* 4️⃣ Bulk + Category Discount Logic */
function calculateDiscount(total) {
  let discount = 0;

  // Bulk Discount
  cart.forEach(item => {
    if (item.quantity >= 3) {
      discount += item.price * item.quantity * 0.10;
    }
  });

  // Category Discount
  cart.forEach(item => {
    if (item.category === "electronics") {
      discount += item.price * item.quantity * 0.05;
    }
  });

  // Time-Based Discount (Evening)
  let hour = new Date().getHours();
  if (hour >= 18 && hour <= 21) {
    discount += total * 0.05;
  }

  return discount;
}

/* 5️⃣ Coupon Code Validation */
function applyCoupon() {
  let code = document.getElementById("coupon").value.trim().toUpperCase();

  if (code === "SAVE10") {
    couponDiscount = 500;
    alert("Coupon Applied!");
  } else {
    couponDiscount = 0;
    alert("Invalid Coupon Code");
  }

  displayCart();
}

displayCart();
</script>

</body>
</html>
